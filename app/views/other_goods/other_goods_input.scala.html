@*
 * Copyright 2021 HM Revenue & Customs
 *
 *@

@this(main_template: views.html.main_template, form: uk.gov.hmrc.play.views.html.helpers.FormWithCSRF, input: uk.gov.hmrc.play.views.html.helpers.Input)
@(dtoForm: Form[OtherGoodsDto], product: ProductTreeLeaf, path: ProductPath, iid: Option[String], countries: List[Country], countriesEU: List[Country], currencies: List[Currency], journeyStart: Option[String])(implicit request: Request[_], messages: Messages)

@import uk.gov.hmrc.play.views.html._
@import play.api.libs.json.{JsObject, Json}
@import util.prefixErrorMessage

@scriptElem = {
  <script src="@routes.Assets.versioned("lib/accessible-autocomplete/dist/accessible-autocomplete.min.js")"></script>
  <script>
    $(document).ready(function () {

      // Get IE or Edge browser version
      var version = detectIE();

      if (version !== 11) {
        var countrySynonymsData = @Html( Json.toJson(countries.map(_.toAutoCompleteJson)).toString )
        enhanceSelectIntoAutoComplete("country", countrySynonymsData)

        var currenciesSynonymsData = @Html( Json.toJson(currencies.map(_.toAutoCompleteJson)).toString )
        enhanceSelectIntoAutoComplete("currency", currenciesSynonymsData)

        var countryEUSynonymsData = @Html( Json.toJson(countriesEU.map(_.toAutoCompleteJson)).toString )
        enhanceSelectIntoAutoComplete("originCountry", countryEUSynonymsData);
      }


      $('button[type=submit]').on('click', function() {
        $('<input>').attr({type: 'hidden', name: 'action', value: $(this).attr('value')}).appendTo('form');
      })

    });
  </script>
}

@linkElem = {
  <link rel="stylesheet" href="@routes.Assets.versioned("lib/accessible-autocomplete/dist/accessible-autocomplete.min.css")" >
}

@main_template(
    title = prefixErrorMessage(messages("label.tell_us_about_the") + " " + messages(s"label.${path.toMessageKey}").toLowerCase(), dtoForm.hasErrors),
    inlineScript = Some(scriptElem),
    inlineLinkElem = Some(linkElem)) {

  @views.html.tags.errors(dtoForm)

  <h1 class="heading-xlarge">
    <span class="heading-secondary">@messages("label.tell_us_about_the")</span>
    @messages(s"label.${path.toMessageKey}")
  </h1>

  @form(action = iid.fold(routes.OtherGoodsInputController.processAddForm(path))(iid => routes.OtherGoodsInputController.processEditForm(iid)) ) {

    @components.select(
      field = dtoForm("country"),
      elementOptions = ("","") :: countries.map(c => (c.code, messages(c.countryName))),
      displayEmptyValue = true,
      '_label -> messages("label.country_the_item_was_bought_in"),
      '_inputHint -> messages("label.if_you_bought_this_item_"),
      '_errorsAboveInput -> true
    )

    @if(journeyStart.contains("euOnly")){
      @components.select(
        field = dtoForm("originCountry"),
        elementOptions = ("","") :: countriesEU.map(c => (c.code,messages(c.countryName))),
        displayEmptyValue = true,
        '_label -> messages("label.country_the_item_was_produced_in"),
        '_inputHint -> messages("label.country_the_item_was_produced_hint"),
        '_errorsAboveInput -> true
      )
    }

    @components.select(
      field = dtoForm("currency"),
      elementOptions = ("","") :: currencies.map(c => (c.code, messages(c.displayName))),
      displayEmptyValue = true,
      '_label -> messages("label.currency_used_to_buy_the_item"),
      '_errorsAboveInput -> true,
      'name -> "currency_source"
    )

    @components.input(
      field = dtoForm("cost"),
      '_label -> messages(s"label.price_paid"),
      '_labelTextClass -> "form-label"
    )

    <div class="form-group">
      <button type="submit" class="button" name="action" value="continue">@messages("label.continue")</button>
    </div>

    <div class="form-group">
      <a href="@routes.SelectProductController.cancel">@messages("label.cancel")</a>
    </div>

  }

}

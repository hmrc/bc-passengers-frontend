@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@this(main_template: views.html.main_template, form: uk.gov.hmrc.play.views.html.helpers.FormWithCSRF, input: uk.gov.hmrc.play.views.html.helpers.Input)
@(f: Form[EnterYourDetailsDto], portsOfArrival: List[PortsOfArrival], journeyStart: Option[String], backLink: Option[String] )(implicit request: Request[_], messages: Messages)

@import uk.gov.hmrc.play.views.html._
@import play.api.libs.json.{JsObject, Json}
@import util.prefixErrorMessage

@scriptElem = {
<script src="@routes.Assets.versioned("lib/accessible-autocomplete/dist/accessible-autocomplete.min.js")"></script>
  <script>
    $(document).ready(function () {

      // Get IE or Edge browser version
      var version = detectIE()

      if (version !== 11) {
        var portOfArrivalSynonymsData = @Html( Json.toJson(portsOfArrival.map(_.toAutoCompleteJson)).toString )
        enhanceSelectIntoAutoComplete("placeOfArrival.selectPlaceOfArrival", portOfArrivalSynonymsData);
      }
    })
  </script>
}

@linkElem = {
<link rel="stylesheet" href="@routes.Assets.versioned("lib/accessible-autocomplete/dist/accessible-autocomplete.min.css")" >
}

@main_template(
  title = prefixErrorMessage(messages("label.enter_your_details"), f.hasErrors), bodyClasses = None,
  inlineScript = Some(scriptElem),
  inlineLinkElem = Some(linkElem),
  backLink = backLink) {


  @views.html.tags.errors(f)

  <h1 class="heading-xlarge">@messages("label.enter_your_details")</h1>

  @form(action = routes.CalculateDeclareController.processEnterYourDetails) {

      @components.input(
        f("firstName"),
        '_label -> messages("label.first_name"),
        '_labelTextClass -> "form-label-bold",
        '_inputClass -> "form-control-3-4",
        '_autoComplete -> "given-name",
        '_error_id -> "firstName-error-message",
        '_errorPrefix -> messages("label.error"),
      )

      @components.input(
        f("lastName"),
        '_label -> messages("label.last_name"),
        '_labelTextClass -> "form-label-bold",
        '_inputClass -> "form-control-3-4",
        '_autoComplete -> "family-name",
        '_error_id -> "lastName-error-message",
        '_errorPrefix -> messages("label.error")
      )
      <fieldset>
          <legend><span class="form-label-bold">@messages("label.select_identification_type")</span></legend>
          <span class="form-hint" style="color: #6f777b;">@messages("label.choose_identification_type")</span>

          <div class="form-group @{if(f("identification").hasErrors) "form-group-error" else "" }" id="identification">

            @if(journeyStart.contains("greatBritain")){
               @components.govuk_radios(
                 f("identification.identificationType"),
                 Seq("passport" -> Messages("label.passport_number"), "euId" -> Messages("label.euId_number"), "driving" -> Messages("label.driving_licence_number"), "telephone" -> Messages("label.telephone_number")),
                 '_labelClass -> "block-label inputLabelBeforeError",
                 '_error_id -> "identification-error-message",
                 '_errorPrefix -> messages("label.error"),
                 Symbol("telephone") -> messages("label.telephone_number_hint"),
                 Symbol("euId") -> Html(s"${messages("label.euId_hint")} ${<a target="_blank" href="https://www.gov.uk/guidance/visiting-the-uk-as-an-eu-eea-or-swiss-citizen#what-you-need-to-enter-the-uk">{messages("label.euId_hint_link")}</a>}")
               )
            } else {
               @components.govuk_radios(
                 f("identification.identificationType"),
                 Seq("passport" -> Messages("label.passport_number"), "euId" -> Messages("label.euId_number")),
                 '_labelClass -> "block-label inputLabelBeforeError",
                 '_error_id -> "identification-error-message",
                 '_errorPrefix -> messages("label.error"),
                 Symbol("euId") -> Html(s"${messages("label.euId_hint")} ${<a target="_blank" href="https://www.gov.uk/guidance/visiting-the-uk-as-an-eu-eea-or-swiss-citizen#what-you-need-to-enter-the-uk">{messages("label.euId_hint_link")}</a>}")
               )
            }
            @f.errors.filter(_.key == "identification").map { error =>
                <span class="error-message" id="identificationNumber-error-message"> <span class="visually-hidden">@messages("label.error") </span> @messages(error.message) </span>
            }
            @components.input(
                f("identification.identificationNumber"),
                '_label -> messages("label.identification_number"),
                '_hintId -> "label-identificationNumber-hint",
                '_labelTextClass -> "form-label-bold",
                '_inputHint -> messages("label.enter_identification_number"),
                '_inputClass -> "form-control-3-4",
                '_error_id -> "identificationNumber-error-message",
                '_errorPrefix -> messages("label.error")
            )
          </div>
      </fieldset>

    <div class="form-group @{if(f("emailAddress").hasErrors) "form-group-error" else "" }" id="emailAddress">
        @f.errors.filter(_.key == "emailAddress").map { error =>
            <span class="error-message" id="email-error-message"> <span class="visually-hidden">@messages("label.error") </span> @messages(error.message) </span>
        }
        @components.input(
            f("emailAddress.email"),
            '_label -> messages("label.email_address"),
            '_hintId -> "label-emailId-hint",
            '_labelTextClass -> "form-label-bold",
            '_inputHint -> messages("label.email_address_hint"),
            '_inputClass -> "form-control-3-4",
            '_autoComplete -> "email",
            '_error_id -> "email-error-message",
        )

        @components.input(
            f("emailAddress.confirmEmail"),
            '_label -> messages("label.confirm_email_address"),
            '_labelTextClass -> "form-label-bold",
            '_inputClass -> "form-control-3-4",
            '_autoComplete -> "email",
            '_error_id -> "email-error-message",
        )
    </div>


    <div class="form-group @{if(f("placeOfArrival").hasErrors) "form-group-error" else "" }" id="placeOfArrival">

        @f.errors.filter(_.key == "placeOfArrival").map { error =>
            <span class="error-message" id="placeOfArrival-error-message"> <span class="visually-hidden">@messages("label.error") </span> @messages(error.message) </span>
        }
        @if(journeyStart.contains("greatBritain")){
          @components.select(
            f("placeOfArrival.selectPlaceOfArrival"),
            elementOptions = ("","") :: portsOfArrival.map(c => (c.code,messages(c.displayName))),
            displayEmptyValue = true,
            '_label -> messages("label.place_of_arrival_ni"),
            '_labelTextClass -> "form-label-bold",
            '_inputHint -> messages("label.for_example_belfast_international_airport"),
            '_errorsAboveInput -> true,
            '_error_id -> "placeOfArrival-error-message",
            '_errorPrefix -> messages("label.error")
          )
        } else {
          @components.select(
            f("placeOfArrival.selectPlaceOfArrival"),
            elementOptions = ("","") :: portsOfArrival.map(c => (c.code,messages(c.displayName))),
            displayEmptyValue = true,
            '_label -> messages("label.place_of_arrival_uk"),
            '_labelTextClass -> "form-label-bold",
            '_inputHint -> messages("label.for_example_heathrow_airport_or_dover"),
            '_errorsAboveInput -> true,
            '_error_id -> "placeOfArrival-error-message",
            '_errorPrefix -> messages("label.error")
          )
        }

      <details class="margin-bottom-20" role="group">

            <summary role="button" aria-controls="details-content-0" aria-expanded="false">
                <span class="summary">@messages("label.place_of_arrival_not_listed")</span>
            </summary>

            <div class="panel panel-border-narrow" id="details-content-0" aria-hidden="false">
                <p>
                    @components.input(
                        f("placeOfArrival.enterPlaceOfArrival"),
                        '_label -> messages("label.enter_place_of_arrival"),
                        '_labelTextClass -> "form-label-bold",
                        '_inputClass -> "form-control-3-4"
                    )
                </p>
            </div>
      </details>
</div>

      <div class="form-group @{if(f("dateTimeOfArrival").hasErrors) "form-group-error" else "" }" id="dateTimeOfArrival">

          @f.errors.filter(_.key == "dateTimeOfArrival").map { error =>
                <span class="error-message" id="dateOfArrival-error-message"> <span class="visually-hidden">@messages("label.error") </span> @messages(error.message) </span>
          }

          @components.dateFieldsFreeInlineLegend(
            f,
            "dateTimeOfArrival.dateOfArrival",
            '_inputHint -> messages("label.for_example_31_10_2021"),
            '_legendSpanClass -> "form-label-bold",
            '_legend -> messages("label.date_of_arrival"),
            '_error_id -> "dateOfArrival-error-message",
            '_errorPrefix -> messages("label.error")
          )

          @components.timeFieldsFreeInlineLegend(
            f,
            "dateTimeOfArrival.timeOfArrival",
            '_inputHint -> messages("label.for_example_930"),
            '_legendSpanClass -> "form-label-bold",
            '_legend -> messages("label.scheduled_time_of_arrival"),
            '_error_id -> "timeOfArrival-error-message",
            '_errorPrefix -> messages("label.error")
          )

      </div>

      <div class="form-group">
        <button type="submit" class="button">@messages("label.continue")</button>
      </div>

  }
}

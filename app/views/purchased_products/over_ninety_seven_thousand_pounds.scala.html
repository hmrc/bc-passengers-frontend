@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@this(main_template: views.html.main_template, displayTaxBreakdown: views.html.components.display_tax_breakdown)
@(previousDeclaration: Boolean, calculatorResponseDto: CalculatorResponseDto, deltaCalc: Option[Calculation], oldAllTax:String, hideExchangeRateInfo: Boolean, backLink: Option[String])(implicit request: Request[_], messages: Messages)

@import util._

@main_template(title = if(deltaCalc.isDefined){messages("label.additional_tax_due_on_these_goods")}else{messages("label.tax_due_on_these_goods")}, backLink = backLink) {

  @if(deltaCalc.isDefined){
  <h1 class="heading-xlarge margin-bottom-20">@messages("label.additional_tax_due_on_these_goods") &pound;@formatMonetaryValue(deltaCalc.get.allTax)</h1>} else{
  <h1 class="heading-xlarge margin-bottom-20">@messages("label.tax_due_on_these_goods") &pound;@formatMonetaryValue(calculatorResponseDto.calculation.allTax)</h1>}

  <table class="responsive-table margin-bottom-30">
    <thead>
      <tr>
        <th scope="col">@messages("label.item")</th>
        <th scope="col">@messages("label.price")</th>
          <th scope="col">@messages("label.purchased_in")</th>
        <th class="numeric" scope="col">
          <span class="table-25">@messages("label.tax_due")</span>
        </th>
      </tr>
    </thead>
    <tbody>
    @calculatorResponseDto.items.map { item =>
      <tr>
        <th scope="row">
          <span class="table-heading" aria-hidden="true">@messages("label.item")</span>
          @messages(item.metadata.description)
        </th>
        <td>
          <span class="table-heading" aria-hidden="true">@messages("label.price")</span>
          @formatMonetaryValue(item.metadata.cost) @messages(item.metadata.currency.displayName)
        </td>
          <td>
              <span class="table-heading" aria-hidden="true">@messages("label.purchased_in")</span>
              @messages(item.metadata.country.countryName)
          </td>
        <td class="numeric">
          <span class="table-heading" aria-hidden="true">@messages("label.tax_due")</span>
          &pound;@formatMonetaryValue(item.calculation.allTax)
        </td>
      </tr>
    }
      <tr>
        <td class="total table-foot" colspan="3">@messages("label.total")</td>
        <td class="total-value numeric table-foot">&pound;@formatMonetaryValue(calculatorResponseDto.calculation.allTax)</td>
      </tr>
    </tbody>
  </table>

    @if(deltaCalc.isDefined){
        <table class="responsive-table margin-bottom-30">
            <tbody id="delta">
            <tr>
                <td>@messages("label.amount_paid_previously")</td>
                <td class="numeric">&pound;@formatMonetaryValue(oldAllTax)</td>
            </tr>

            <tr>
                <td class="total table-foot">@messages("label.total_due_now")</td>
                <td class="total-value numeric table-foot">&pound;@formatMonetaryValue(deltaCalc.get.allTax)</td>
            </tr>
            </tbody>
        </table>
    }

    <div class="panel panel-border-wide">
        <p>@messages("label.tax_on_all_if_go_over_allowance")</p>
    </div>
    <p><a href="@controllers.routes.DashboardController.showDashboard()">@messages("label.change_your_goods")</a></p>
    @displayTaxBreakdown(calculatorResponseDto)
    <br>
      @if(!hideExchangeRateInfo) {

          <p class="margin-top-30">
            @messages("label.we_use") <a href = "https://www.gov.uk/government/collections/exchange-rates-for-customs-and-vat" target="_blank">@messages("label.exchange_rates")</a>
            @messages("label.to_make_this_calculation")</p>
      }

      <h2 class="heading-medium">@messages("label.declaring_these_goods")</h2>

      <p>@messages("label.you_cannot_make_payments")</p>
        @if(previousDeclaration) {
            <p>@messages("label.amend_these_goods")</p>
        } else {
            <p>@messages("label.declare_these_goods")</p>
        }


        <p><a href="@controllers.routes.TravelDetailsController.newSession()">@messages("label.start_again")</a></p>

}
